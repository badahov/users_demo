(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[10],{155:function(e,t,n){"use strict";var r=n(55),o=n.n(r);t.a={path:"role",getComponent:function(e,t){Promise.all([n.e(1),n.e(2),n.e(0),n.e(3),n.e(5),n.e(4),n.e(7),n.e(6),n.e(8),n.e(10),n.e(19),n.e(21)]).then(n.bind(null,279)).then((function(e){return t(null,e.default)})).catch((function(){return o.a}))}}},275:function(e,t,n){},279:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),l=n(14),a=n(15),i=n(59),s=n(56),c=n(46),u=n(274),m=Object(a.applyMiddleware)(Object(i.a)("system"),c.a,Object(u.createLogger)({collapsed:!0}))(a.createStore)(Object(a.combineReducers)({system:Object(s.a)({name:"system",models:[{name:"user",points:["current"]},{name:"role",points:["items"]},{name:"permission",points:["item"]}]})})),p=n(60),d=n(4),f=n(5);function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.e.post;return new d.e({pointApi:e,type:n,data:t})}var b={user:{item:"interface-users/user",current:"interface-users/user-current"},role:{items:"interface-users/roles",add:"interface-users/role-add",edit:"interface-users/role-edit",delete:"interface-users/role-delete"},permission:{item:"interface-users/permission",switch:"interface-users/role-permission"}};function h(e,t,n){switch(e){case"roleItems":return y(b.role.items,t,d.e.get).result();case"roleAdd":return y(b.role.add,t,d.e.post).result().then((function(e){}));case"roleEdit":return y(b.role.edit,t,d.e.post).result().then((function(e){}));case"roleDelete":return y(b.role.delete,t,d.e.post).result(n).then((function(e){if(e)return y(h.roles).result()}));case"permissionItem":return y(b.permission.item,t,d.e.get).result();case"permissionSwitch":return y(b.permission.switch,t,d.e.post).result().then((function(e){}));case"userItem":return new d.e({data:t,pointApi:b.item,type:d.e.get}).result();case"userCurrent":return new d.e({domain:f.a.domain.auth,type:d.e.get,pointApi:b.user.current}).result();case"userEdit":return new d.e({data:t,pointApi:b.edit}).result()}}var E=n(47),v=n.n(E),g=n(2),O=n.n(g),S=n(11),w=n(292),j=n(303),P=n(300),I=n(111),k=n(3),R=n(299),C=n(26),_=n(159),A=n(61),D=n(29),x=n(301),N=n(297),q=n(302),F=n(298),T=n(281),z=n(294),M=n(293);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=C.a.Group,V=F.a.Search,Q=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=B(t).call(this,e),n=!o||"object"!==L(o)&&"function"!=typeof o?G(r):o,K(G(n),"handleSubmit",(function(e){e.preventDefault(),n.props.form.validateFieldsAndScroll((function(e,t){e||(delete t.confirm,n.props.actionRole("add",t))}))})),K(G(n),"onClose",(function(){n.props.onClose()})),K(G(n),"onRoleEditAction",(function(e,t){var n=e.target.parentElement.parentElement.parentElement.parentElement,r=n.querySelector(".link-role-name-".concat(t)),o=n.querySelector(".input-role-name-".concat(t)),l=n.querySelector(".btn-role-edit-".concat(t)),a=n.querySelector(".btn-role-delete-".concat(t)),i=n.querySelector(".btn-role-save-".concat(t));r.style.display="none",o.style.display="inline",l.style.display="none",a.style.display="none",i&&(i.style.display="inline")})),K(G(n),"onRoleDelete",(function(e){n.props.actionRole("delete",{id:e},(function(e){return"ok"===e.status?(e.msg&&(T.a.success(e.msg),n.props.onRoleSelect(0)),!e.result||e.result):e.msg?(T.a.error(n._errorMsg(e.msg)),!1):void 0}))})),K(G(n),"onRoleEdit",(function(e,t,r){var o=e.target.parentElement.parentElement.parentElement.parentElement;n.props.actionRole("edit",{id:t,name:r},(function(e){if("ok"===e.status){if(e.msg&&T.a.success(e.msg),e.result){var r=o.querySelector(".link-role-name-".concat(t)),l=o.querySelector(".input-role-name-".concat(t)),a=o.querySelector(".btn-role-edit-".concat(t)),i=o.querySelector(".btn-role-delete-".concat(t)),s=o.querySelector(".btn-role-save-".concat(t));return r.style.display="inline",l.style.display="none",a.style.display="inline",i.style.display="inline",s&&(s.style.display="none"),e.result}return!0}if(e.msg)return T.a.error(n._errorMsg(e.msg)),!1}))})),K(G(n),"shouldComponentUpdate",(function(e,t){return n.props.visible!==e.visible&&n.setState({visible:e.visible}),!0})),n.state={visible:e.visible},n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator;return o.a.createElement(z.a,{title:this.props.title,width:550,onClose:this.onClose,visible:this.state.visible,zIndex:1050},o.a.createElement(A.a,{style:{marginBottom:"20px"}},o.a.createElement(D.a,{span:24},o.a.createElement(q.a,{layout:"inline",onSubmit:this.handleSubmit},o.a.createElement(q.a.Item,{hasFeedback:!0},t("name",{})(o.a.createElement(F.a,{placeholder:"Название новой роли"}))),o.a.createElement(q.a.Item,null,o.a.createElement(C.a,{type:"primary",htmlType:"submit"},"Добавить")))),o.a.createElement(D.a,{span:24},o.a.createElement(x.a,{size:"small",style:{marginTop:"10px"},bordered:!0,dataSource:this.props.roleList,renderItem:function(t){return o.a.createElement(x.a.Item,{className:"list-role-item list-role-item-".concat(t.id),actions:t.editable?[o.a.createElement(H,null,o.a.createElement(C.a,{className:"btn-role-edit btn-role-edit-".concat(t.id),onClick:function(n){return e.onRoleEditAction(n,t.id)},size:"small",icon:"edit"}),o.a.createElement(M.a,{title:"Удалить роль?",onConfirm:function(){return e.onRoleDelete(t.id)},okText:"Да",cancelText:"Нет",placement:"left",zIndex:1050},o.a.createElement(C.a,{className:"btn-role-delete btn-role-delete-".concat(t.id),size:"small",icon:"delete"})))]:null},o.a.createElement(S.a,{onClick:function(n){e.props.onRoleSelect(n,t.id)},className:"link-role-name link-role-name-".concat(t.id),style:{width:"100%"}},t.name),o.a.createElement(V,{className:"input-role-name input-role-name-".concat(t.id),placeholder:"Название новой роли",enterButton:o.a.createElement(k.a,{type:"save"}),size:"small",defaultValue:t.name,onSearch:function(n,r){return e.onRoleEdit(r,t.id,n)}}))}}))))}}])&&U(n.prototype,r),l&&U(n,l),t}(r.Component);K(Q,"defaultProps",{visible:!0,visibleId:null,successionId:null,operationId:null,inputSourceId:null,stageId:null,title:null});var W=Q;function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=q.a.create({name:"user_add_form",mapPropsToFields:function(e){return{title:q.a.createFormField(Y({},e.sourceTitle,{value:e.sourceTitle}))}}})(W);function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ae=w.a.Header,ie=w.a.Content,se=w.a.Sider,ce=j.a.Panel,ue=P.a.Meta,me=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=ne(t).call(this,e),n=!o||"object"!==ee(o)&&"function"!=typeof o?re(r):o,le(re(n),"toggle",(function(){n.setState({collapsed:!n.state.collapsed})})),le(re(n),"onClose",(function(){n.setState({visibleSourceAddForm:!1})})),le(re(n),"onOpen",(function(){n.setState({visibleSourceAddForm:!n.state.visibleSourceAddForm,visibleId:1})})),le(re(n),"onRoleSelect",(function(e,t){for(var r=0;r<n.props.role.length;r++){var o=n.props.role[r];if(o.id===t){n.setState({selectRoleName:o.name,selectRoleId:o.id}),n.props.modelPermissionItem({id:o.id});break}}document.querySelectorAll(".list-role-item").forEach((function(e){e.setAttribute("style","background: #fff")})),document.querySelector(".list-role-item-".concat(t)).setAttribute("style","background: #fafafa")})),le(re(n),"shouldComponentUpdate",(function(e,t){return e.permission!==n.props.permission||t.visibleSourceAddForm!==n.state.visibleSourceAddForm||t.collapsed!==n.state.collapsed||e.role!==n.props.role})),le(re(n),"permissionsSwitch",(function(e,t,r){n.props.modelPermissionSwitch({enabled:r,permission_id:t,role_id:n.state.selectRoleId})})),n.state={selectRoleName:"Гость",selectRoleId:0,collapsed:!0,visibleSourceAddForm:!1,visibleId:null,items:e.items,loading:!0,operationId:""},e.modelServer(),n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this;if(this.props.current){var t=!this.props.current;return o.a.createElement(w.a,null,o.a.createElement(se,{width:300,trigger:null,collapsible:!0,collapsed:this.state.collapsed},o.a.createElement("div",{className:"logo"},"USER"),o.a.createElement(I.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["2"]},o.a.createElement(I.a.Item,{key:"1"},o.a.createElement(S.a,{to:"/"},o.a.createElement(k.a,{type:"team"}),o.a.createElement("span",null,"Пользователи"))),o.a.createElement(I.a.Item,{key:"2"},o.a.createElement(S.a,{to:"/role"},o.a.createElement(k.a,{type:"cluster"}),o.a.createElement("span",null,"Роли"))),o.a.createElement(I.a.ItemGroup,{key:"roles",title:""},this.props.role?this.props.role.map((function(t){return o.a.createElement(I.a.Item,{onClick:function(n){e.onRoleSelect(n,t.id)},key:"role-".concat(t.id)},o.a.createElement(k.a,{type:"property-safety"}),o.a.createElement("span",null,t.name))})):null))),o.a.createElement(w.a,null,o.a.createElement(v.a,{title:this.state.selectRoleName}),o.a.createElement(ae,null,o.a.createElement(R.a,{title:o.a.createElement("span",null,o.a.createElement(k.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:this.toggle}),"Управление ролями"),subTitle:"текущая: ".concat(this.state.selectRoleName),extra:[o.a.createElement(C.a,{key:"add-role",className:"btn-user-add",onClick:function(){return e.onOpen()},type:"primary",size:"small"},"Управление ролями"),o.a.createElement(d.c,{key:"logout-1"})]})),o.a.createElement(ie,{className:"user-list"},o.a.createElement(_.a,{tip:"Загрузка...",size:"large",spinning:t},o.a.createElement(A.a,null,o.a.createElement(D.a,{span:24},o.a.createElement(j.a,{defaultActiveKey:["1"]},this.props.permission.modules?this.props.permission.modules.map((function(t){return o.a.createElement(ce,{header:"".concat(t.name,": ").concat(t.desc),key:t.group},o.a.createElement(x.a,{grid:{gutter:16,xs:1,sm:1,md:2,lg:3,xl:4,xxl:4},dataSource:t.permissions,renderItem:function(t,n){return o.a.createElement(x.a.Item,null,o.a.createElement(S.a,{onClick:function(){e.permissionsSwitch(t.group,t.id,t.enabled)}},o.a.createElement(N.a,{content:t.desc,title:t.name},o.a.createElement(P.a,{className:O()("permissions-default",{"permissions-enabled":t.enabled}),size:"small"},o.a.createElement(ue,{avatar:t.enabled?o.a.createElement(k.a,{type:"check"}):o.a.createElement(k.a,{type:"stop"}),title:t.name})))))}}))})):null)),o.a.createElement($,{visible:this.state.visibleSourceAddForm,visibleId:this.state.visibleId,title:"Роли",onRoleSelect:this.onRoleSelect,roleList:this.props.role,actionRole:this.props.actionRole,onClose:this.onClose,wrappedComponentRef:function(t){return e.form=t}}))))))}return null}}])&&te(n.prototype,r),l&&te(n,l),t}(o.a.Component);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fe=Object(l.connectAdvanced)((function(e){var t="system",n={},r=Object(p.a)(h,t,e),o=function(){return r("roleItems")},a=function(e){return r("permissionItem",e)},i=function(e){return r("permissionSwitch",e)},s=function(e){return r("roleEdit",e,(function(e){return e}))},c=function(e){return r("roleDelete",e,(function(e){return e}))},u=function(){r("userCurrent"),o(),a({id:0})};return function(e,t){var r=function(e){return null===e};console.log("nextState",e);var m=!!r(e.system.userCurrent),p=r(e.system.roleItems)?null:e.system.roleItems,d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){de(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{loading:m,permission:r(e.system.permissionItem)?null:e.system.permissionItem,role:p,access:r(e.system.userCurrent)?null:e.system.userCurrent.access,current:r(e.system.userCurrent)?null:e.system.userCurrent.data,modelServer:u,modelRoleItems:o,modelPermissionItem:a,modelPermissionSwitch:i,modelRoleDelete:c,modelRoleEdit:s});return t,Object(l.shallowEqual)(n,d)||(n=d),n}}))(me);n(275),t.default=function(e){var t=e.location,n=e.params;return o.a.createElement(l.Provider,{store:m},o.a.createElement(fe,{location:t,params:n}))}}}]);
//# sourceMappingURL=role.js.map