(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[8],{168:function(e,t,r){"use strict";var n=r(37),o=r.n(n);t.a={path:"role",getComponent:function(e,t){Promise.all([r.e(1),r.e(0),r.e(3),r.e(2),r.e(5),r.e(4),r.e(8),r.e(16)]).then(r.bind(null,299)).then((function(e){return t(null,e.default)})).catch((function(){return o.a}))}}},295:function(e,t,r){},299:function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),a=r(16),i=r(11),l=r(51),s=r(62),c=r(60),u=Object(i.a)(Object(s.a)("system"),l.a)(i.d)(Object(i.c)({system:Object(c.a)({name:"system",models:[{name:"user",points:["current"]},{name:"role",points:["items"]},{name:"permission",points:["item"]}]})})),m=r(63),d=r(21),p=r(4);function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return new d.a({pointApi:e,type:r,data:t})}var b={user:{item:"interface-users/user",current:"interface-users/user-current"},role:{items:"interface-users/roles",add:"interface-users/role-add",edit:"interface-users/role-edit",delete:"interface-users/role-delete"},permission:{item:"interface-users/permission",switch:"interface-users/role-permission"}};function y(e,t,r){switch(e){case"roleItems":return f(b.role.items,t,"GET").result();case"roleAdd":return f(b.role.add,t).result(r);case"roleEdit":return f(b.role.edit,t).result(r);case"roleDelete":return f(b.role.delete,t).result(r);case"permissionItem":return f(b.permission.item,t,"GET").result(r);case"permissionSwitch":return f(b.permission.switch,t).result(r);case"userItem":return new d.a({data:t,pointApi:b.item,type:"GET"}).result();case"userCurrent":return new d.a({domain:p.a.domain.auth,type:"GET",pointApi:b.user.current}).result();case"userEdit":return new d.a({data:t,pointApi:b.edit}).result(r);default:return null}}var v=r(1),E=r.n(v),h=r(31),O=r(2),S=r.n(O),g=r(22),R=r.n(g),w=r(173),j=r.n(w),P=r(293),q=r.n(P),k=r(294),A=r.n(k),I=r(12),C=r(315),_=r(322),T=r(320),D=r(121),N=r(3),x=r(318),F=r(29),z=r(172),G=r(66),L=r(33),U=r(319),B=r(316),J=r(59),K=r(321),H=r(317),M=r(312),V=r(311);function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ee=F.a.Group,te=H.a.Search,re=function(e){function t(e){var r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=X(t).call(this,e),r=!o||"object"!==Q(o)&&"function"!=typeof o?Y(n):o,$(Y(r),"handleSubmit",(function(e){e.preventDefault();var t=r.props,n=t.form,o=t.actionAdd;n.validateFieldsAndScroll((function(e,t){e||(delete t.confirm,o(t))}))})),$(Y(r),"onRoleEditAction",(function(e,t){var r=e.target.parentElement.parentElement.parentElement.parentElement,n=r.querySelector(".link-role-name-".concat(t)),o=r.querySelector(".input-role-name-".concat(t)),a=r.querySelector(".btn-role-edit-".concat(t)),i=r.querySelector(".btn-role-delete-".concat(t)),l=r.querySelector(".btn-role-save-".concat(t));n.setAttribute("style","display: none;"),o.setAttribute("style","display: inline;"),a.setAttribute("style","display: none;"),i.setAttribute("style","display: none;"),l&&l.setAttribute("style","display: inline;")})),$(Y(r),"onRoleDelete",(function(e){var t=r.props,n=t.actionDelete,o=t.onRoleSelect;n({id:e},(function(e){return o(0),e}))})),$(Y(r),"onRoleEdit",(function(e,t,n){var o=r.props.actionEdit,a=e.target.parentElement.parentElement.parentElement.parentElement;o({id:t,name:n},(function(e){if("ok"===e.status){var r=a.querySelector(".link-role-name-".concat(t)),n=a.querySelector(".input-role-name-".concat(t)),o=a.querySelector(".btn-role-edit-".concat(t)),i=a.querySelector(".btn-role-delete-".concat(t)),l=a.querySelector(".btn-role-save-".concat(t));r.setAttribute("style","display: inline;"),n.setAttribute("style","display: none;"),o.setAttribute("style","display: inline;"),i.setAttribute("style","display: inline;"),l.setAttribute("style","display: none;")}return e}))})),$(Y(r),"shouldComponentUpdate",(function(e){return r.props.visible!==e.visible&&r.setState({visible:e.visible}),!0}));var a=e.visible;return r.state={visible:a},r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this,t=this.props,r=t.title,n=t.form.getFieldDecorator,a=t.onClose,i=t.roleList,l=t.onRoleSelect,s=this.state.visible;return o.a.createElement(M.a,{title:r,width:550,onClose:a,visible:s,zIndex:1050},o.a.createElement(G.a,{style:{marginBottom:"20px"}},o.a.createElement(L.a,{span:24},o.a.createElement(K.a,{layout:"inline",onSubmit:this.handleSubmit},o.a.createElement(K.a.Item,{hasFeedback:!0},n("name",{})(o.a.createElement(H.a,{placeholder:"Название новой роли"}))),o.a.createElement(K.a.Item,null,o.a.createElement(F.a,{type:"primary",htmlType:"submit"},"Добавить")))),o.a.createElement(L.a,{span:24},o.a.createElement(U.a,{size:"small",style:{marginTop:"10px"},bordered:!0,dataSource:i,renderItem:function(t){return o.a.createElement(U.a.Item,{className:"list-role-item list-role-item-".concat(t.id),actions:t.editable?[o.a.createElement(ee,{key:"btn-g-1"},o.a.createElement(F.a,{className:"btn-role-edit btn-role-edit-".concat(t.id),onClick:function(r){return e.onRoleEditAction(r,t.id)},size:"small",icon:"edit"}),o.a.createElement(V.a,{title:"Удалить роль?",onConfirm:function(){return e.onRoleDelete(t.id)},okText:"Да",cancelText:"Нет",placement:"left",zIndex:1050},o.a.createElement(F.a,{className:"btn-role-delete btn-role-delete-".concat(t.id),size:"small",icon:"delete"})))]:null},o.a.createElement(F.a,{type:"link",onClick:function(){return l(t.id)},className:"link-role-name link-role-name-".concat(t.id),style:{width:"100%"}},t.name),o.a.createElement(te,{className:"input-role-name input-role-name-".concat(t.id),placeholder:"Название новой роли",enterButton:o.a.createElement(N.a,{type:"save"}),size:"small",defaultValue:t.name,onSearch:function(r,n){return e.onRoleEdit(n,t.id,r)}}))}}))))}}])&&W(r.prototype,n),a&&W(r,a),t}(n.Component);re.propTypes={title:E.a.string.isRequired,visible:E.a.bool.isRequired,actionAdd:E.a.func.isRequired,actionDelete:E.a.func.isRequired,actionEdit:E.a.func.isRequired,onRoleSelect:E.a.func.isRequired,onClose:E.a.func.isRequired,form:E.a.objectOf(E.a.oneOfType([E.a.func])).isRequired,roleList:E.a.arrayOf(E.a.shape({id:E.a.number.isRequired,name:E.a.string.isRequired,editable:E.a.number.isRequired})).isRequired};var ne=re;function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var le=K.a.create({name:"user_add_form",mapPropsToFields:function(e){return{title:K.a.createFormField(ae({},e.sourceTitle,{value:e.sourceTitle}))}}})(ne),se=r(36);function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var be=C.a.Header,ye=C.a.Content,ve=C.a.Sider,Ee=_.a.Panel,he=T.a.Meta,Oe={},Se=function(e){function t(e){var r,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=me(t).call(this,e),r=!o||"object"!==ce(o)&&"function"!=typeof o?de(n):o,fe(de(r),"toggle",(function(){var e=r.state.collapsed;r.setState({collapsed:!e})})),fe(de(r),"onClose",(function(){r.setState({visibleSourceAddForm:!1})})),fe(de(r),"onOpen",(function(){var e=r.state.visibleSourceAddForm;r.setState({visibleSourceAddForm:!e,visibleId:1})})),fe(de(r),"onRoleSelect",(function(e,t){for(var n=r.props,o=n.role,a=n.modelPermissionItem,i=0;i<o.length;i+=1){var l=o[i],s=l.id,c=l.name;if(s===t){r.setState({selectRoleName:c,selectRoleId:s}),a({id:s});break}}var u=document.querySelectorAll(".list-role-item");j()(u,(function(e){e.setAttribute("style","background: #fff")}));var m=document.querySelector(".list-role-item-".concat(t));m&&m.setAttribute("style","background: #fafafa")})),fe(de(r),"shouldComponentUpdate",(function(e,t){var n=r.props,o=n.permission,a=n.role,i=r.state,l=i.visibleSourceAddForm,s=i.collapsed,c=i.modules;return e.permission!==o&&r.setState({modules:e.permission.modules}),t.modules!==c||t.visibleSourceAddForm!==l||t.collapsed!==s||e.role!==a})),fe(de(r),"findGroupPermission",(function(e,t,r){var n=null,o=null;return j()(e,(function(e,a){if(e.group===t){n=a;var i=q()(e.permissions,(function(e){return e.id===r}));o=i}})),{group:Number(n),permission:Number(o)}})),fe(de(r),"permissionsSwitch",(function(e,t,n){var o=r.props.modelPermissionSwitch,a=r.state,i=a.selectRoleId,l=a.modules,s=A()(l);o({enabled:n,permission_id:t,role_id:i},(function(o){if("ok"===o.status){var a=r.findGroupPermission(s,e,t);s[a.group].permissions[a.permission].enabled=!n,r.setState({modules:s})}}))})),r.state={selectRoleName:"Гость",selectRoleId:0,collapsed:!0,visibleSourceAddForm:!1,visibleId:null,modules:null},e.modelServer(),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this,t=this.props,r=t.current,n=t.role,a=t.modelRoleDelete,i=t.modelRoleEdit,l=t.modelRoleAdd,s=this.state,c=s.collapsed,u=s.selectRoleName,m=s.visibleSourceAddForm,d=s.visibleId,p=s.modules;if(r&&p){var f=!r;return o.a.createElement(h.b,{context:Oe},o.a.createElement(C.a,null,o.a.createElement(ve,{width:300,trigger:null,collapsible:!0,collapsed:c},o.a.createElement("div",{className:"logo"},"USER"),o.a.createElement(D.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["2"]},o.a.createElement(D.a.Item,{key:"1"},o.a.createElement(I.a,{to:"/"},o.a.createElement(N.a,{type:"team"}),o.a.createElement("span",null,"Пользователи"))),o.a.createElement(D.a.Item,{key:"2"},o.a.createElement(I.a,{to:"/role"},o.a.createElement(N.a,{type:"cluster"}),o.a.createElement("span",null,"Роли"))),o.a.createElement(D.a.ItemGroup,{key:"roles",title:""},n?R()(n,(function(t){return o.a.createElement(D.a.Item,{onClick:function(r){return e.onRoleSelect(r,t.id)},key:"role-".concat(t.id)},o.a.createElement(N.a,{type:"property-safety"}),o.a.createElement("span",null,t.name))})):null))),o.a.createElement(C.a,null,o.a.createElement(h.a,{title:u}),o.a.createElement(be,null,o.a.createElement(x.a,{title:o.a.createElement("span",null,o.a.createElement(N.a,{className:"trigger",type:c?"menu-unfold":"menu-fold",onClick:this.toggle}),"Управление ролями"),subTitle:"текущая: ".concat(u),extra:[o.a.createElement(F.a,{key:"add-role",className:"btn-user-add",onClick:function(){return e.onOpen()},type:"primary",size:"small"},"Управление ролями"),o.a.createElement(J.a,{key:"logout-1"})]})),o.a.createElement(ye,{className:"user-list"},o.a.createElement(z.a,{tip:"Загрузка...",size:"large",spinning:f},o.a.createElement(G.a,null,o.a.createElement(L.a,{span:24},o.a.createElement(_.a,{defaultActiveKey:["1"]},p?R()(p,(function(t){return o.a.createElement(Ee,{header:"".concat(t.name,": ").concat(t.desc),key:t.group},o.a.createElement(U.a,{grid:{gutter:16,xs:1,sm:1,md:2,lg:3,xl:4,xxl:4},dataSource:t.permissions,renderItem:function(t){return o.a.createElement(U.a.Item,null,o.a.createElement(F.a,{className:"btn-permission",onClick:function(){e.permissionsSwitch(t.group,t.id,t.enabled)}},o.a.createElement(B.a,{content:t.desc,title:t.name},o.a.createElement(T.a,{className:S()("permissions-default",{"permissions-enabled":t.enabled}),size:"small"},o.a.createElement(he,{avatar:t.enabled?o.a.createElement(N.a,{type:"check"}):o.a.createElement(N.a,{type:"stop"}),title:t.name})))))}}))})):null)),o.a.createElement(le,{visible:m,visibleId:d,title:"Роли",roleList:n,onRoleSelect:this.onRoleSelect,actionDelete:a,actionEdit:i,actionAdd:l,onClose:this.onClose,wrappedComponentRef:function(t){e.form=t}})))))))}return null}}])&&ue(r.prototype,n),a&&ue(r,a),t}(o.a.Component);Se.defaultProps={permission:null,role:null},Se.propTypes={current:se.b.isRequired,modelPermissionItem:E.a.func.isRequired,modelPermissionSwitch:E.a.func.isRequired,modelRoleAdd:E.a.func.isRequired,modelRoleDelete:E.a.func.isRequired,modelRoleEdit:E.a.func.isRequired,modelServer:E.a.func.isRequired,permission:E.a.shape({id:E.a.number.isRequired,name:E.a.string.isRequired,editable:E.a.number.isRequired,modules:E.a.arrayOf(E.a.shape({name:E.a.string.isRequired,desc:E.a.string.isRequired,group:E.a.number.isRequired}))}),role:E.a.arrayOf(E.a.shape({id:E.a.number.isRequired,name:E.a.string.isRequired,editable:E.a.number.isRequired}))};var ge=Se;function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var je=Object(a.c)((function(e){var t="system",r={},n=Object(m.a)(y,t,e),o=function(){return n("roleItems")},i=function(e){return n("permissionItem",e)},l=function(e,t){return n("permissionSwitch",e,t)},s=function(e){return n("roleAdd",e,(function(e){return e}))},c=function(e,t){return n("roleEdit",e,t)},u=function(e){return n("roleDelete",e,(function(e){return e}))},d=function(){n("userCurrent"),o(),i({id:0})};return function(e,t){var n=function(e){return null===e},m=n(e.system.userCurrent),p=n(e.system.roleItems)?null:e.system.roleItems,f=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){we(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{loading:m,permission:n(e.system.permissionItem)?null:e.system.permissionItem,role:p,access:n(e.system.userCurrent)?{}:e.system.userCurrent.access,current:n(e.system.userCurrent)?{}:e.system.userCurrent.data,modelServer:d,modelRoleItems:o,modelPermissionItem:i,modelPermissionSwitch:l,modelRoleDelete:u,modelRoleEdit:c,modelRoleAdd:s});return Object(a.d)(r,f)||(r=f),r}}))(ge),Pe=(r(295),function(e){var t=e.location,r=e.params;return o.a.createElement(a.a,{store:u},o.a.createElement(je,{location:t,params:r}))});Pe.propTypes={location:se.c.isRequired,params:se.e.isRequired};t.default=Pe}}]);
//# sourceMappingURL=role.js.map