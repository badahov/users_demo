(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[10],{155:function(e,t,n){"use strict";var r=n(55),o=n.n(r);t.a={path:"role",getComponent:function(e,t){Promise.all([n.e(1),n.e(2),n.e(0),n.e(3),n.e(5),n.e(4),n.e(7),n.e(6),n.e(8),n.e(10),n.e(20)]).then(n.bind(null,278)).then((function(e){return t(null,e.default)})).catch((function(){return o.a}))}}},274:function(e,t,n){},278:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),l=n(14),a=n(15),i=n(59),s=n(56),c=n(46),u=Object(a.applyMiddleware)(Object(i.a)("system"),c.a)(a.createStore)(Object(a.combineReducers)({system:Object(s.a)({name:"system",models:[{name:"user",points:["current"]},{name:"role",points:["items"]},{name:"permission",points:["item"]}]})})),m=n(60),p=n(4),d=n(5);function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.post;return new p.e({pointApi:e,type:n,data:t})}var y={user:{item:"interface-users/user",current:"interface-users/user-current"},role:{items:"interface-users/roles",add:"interface-users/role-add",edit:"interface-users/role-edit",delete:"interface-users/role-delete"},permission:{item:"interface-users/permission",switch:"interface-users/role-permission"}};function b(e,t,n){switch(e){case"roleItems":return f(y.role.items,t,p.e.get).result();case"roleAdd":return f(y.role.add,t,p.e.post).result().then((function(e){}));case"roleEdit":return f(y.role.edit,t,p.e.post).result().then((function(e){}));case"roleDelete":return f(y.role.delete,t,p.e.post).result(n).then((function(e){if(e)return f(b.roles).result()}));case"permissionItem":return f(y.permission.item,t,p.e.get).result();case"permissionSwitch":return f(y.permission.switch,t,p.e.post).result().then((function(e){}));case"userItem":return new p.e({data:t,pointApi:y.item,type:p.e.get}).result();case"userCurrent":return new p.e({domain:d.a.domain.auth,type:p.e.get,pointApi:y.user.current}).result();case"userEdit":return new p.e({data:t,pointApi:y.edit}).result()}}var h=n(47),E=n.n(h),v=n(2),g=n.n(v),O=n(11),S=n(291),w=n(302),j=n(299),P=n(111),I=n(3),k=n(298),R=n(26),C=n(159),_=n(61),A=n(29),D=n(300),N=n(296),q=n(301),x=n(297),F=n(280),T=n(293),z=n(292);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=R.a.Group,H=x.a.Search,V=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=B(t).call(this,e),n=!o||"object"!==M(o)&&"function"!=typeof o?G(r):o,K(G(n),"handleSubmit",(function(e){e.preventDefault(),n.props.form.validateFieldsAndScroll((function(e,t){e||(delete t.confirm,n.props.actionAdd(t))}))})),K(G(n),"onClose",(function(){n.props.onClose()})),K(G(n),"onRoleEditAction",(function(e,t){var n=e.target.parentElement.parentElement.parentElement.parentElement,r=n.querySelector(".link-role-name-".concat(t)),o=n.querySelector(".input-role-name-".concat(t)),l=n.querySelector(".btn-role-edit-".concat(t)),a=n.querySelector(".btn-role-delete-".concat(t)),i=n.querySelector(".btn-role-save-".concat(t));r.style.display="none",o.style.display="inline",l.style.display="none",a.style.display="none",i&&(i.style.display="inline")})),K(G(n),"onRoleDelete",(function(e){n.props.actionDelete({id:e},(function(e){return"ok"===e.status?(e.msg&&(F.a.success(e.msg),n.props.onRoleSelect(0)),!e.result||e.result):e.msg?(F.a.error(n._errorMsg(e.msg)),!1):void 0}))})),K(G(n),"onRoleEdit",(function(e,t,r){var o=e.target.parentElement.parentElement.parentElement.parentElement;n.props.actionEdit({id:t,name:r},(function(e){if("ok"===e.status){if(e.msg&&F.a.success(e.msg),e.result){var r=o.querySelector(".link-role-name-".concat(t)),l=o.querySelector(".input-role-name-".concat(t)),a=o.querySelector(".btn-role-edit-".concat(t)),i=o.querySelector(".btn-role-delete-".concat(t)),s=o.querySelector(".btn-role-save-".concat(t));return r.style.display="inline",l.style.display="none",a.style.display="inline",i.style.display="inline",s&&(s.style.display="none"),e.result}return!0}if(e.msg)return F.a.error(n._errorMsg(e.msg)),!1}))})),K(G(n),"shouldComponentUpdate",(function(e,t){return n.props.visible!==e.visible&&n.setState({visible:e.visible}),!0})),n.state={visible:e.visible},n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator;return o.a.createElement(T.a,{title:this.props.title,width:550,onClose:this.onClose,visible:this.state.visible,zIndex:1050},o.a.createElement(_.a,{style:{marginBottom:"20px"}},o.a.createElement(A.a,{span:24},o.a.createElement(q.a,{layout:"inline",onSubmit:this.handleSubmit},o.a.createElement(q.a.Item,{hasFeedback:!0},t("name",{})(o.a.createElement(x.a,{placeholder:"Название новой роли"}))),o.a.createElement(q.a.Item,null,o.a.createElement(R.a,{type:"primary",htmlType:"submit"},"Добавить")))),o.a.createElement(A.a,{span:24},o.a.createElement(D.a,{size:"small",style:{marginTop:"10px"},bordered:!0,dataSource:this.props.roleList,renderItem:function(t){return o.a.createElement(D.a.Item,{className:"list-role-item list-role-item-".concat(t.id),actions:t.editable?[o.a.createElement(L,null,o.a.createElement(R.a,{className:"btn-role-edit btn-role-edit-".concat(t.id),onClick:function(n){return e.onRoleEditAction(n,t.id)},size:"small",icon:"edit"}),o.a.createElement(z.a,{title:"Удалить роль?",onConfirm:function(){return e.onRoleDelete(t.id)},okText:"Да",cancelText:"Нет",placement:"left",zIndex:1050},o.a.createElement(R.a,{className:"btn-role-delete btn-role-delete-".concat(t.id),size:"small",icon:"delete"})))]:null},o.a.createElement(O.a,{onClick:function(n){e.props.onRoleSelect(n,t.id)},className:"link-role-name link-role-name-".concat(t.id),style:{width:"100%"}},t.name),o.a.createElement(H,{className:"input-role-name input-role-name-".concat(t.id),placeholder:"Название новой роли",enterButton:o.a.createElement(I.a,{type:"save"}),size:"small",defaultValue:t.name,onSearch:function(n,r){return e.onRoleEdit(r,t.id,n)}}))}}))))}}])&&U(n.prototype,r),l&&U(n,l),t}(r.Component);K(V,"defaultProps",{visible:!0,visibleId:null,successionId:null,operationId:null,inputSourceId:null,stageId:null,title:null});var Q=V;function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=q.a.create({name:"user_add_form",mapPropsToFields:function(e){return{title:q.a.createFormField(X({},e.sourceTitle,{value:e.sourceTitle}))}}})(Q);function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var le=S.a.Header,ae=S.a.Content,ie=S.a.Sider,se=w.a.Panel,ce=j.a.Meta,ue=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=te(t).call(this,e),n=!o||"object"!==$(o)&&"function"!=typeof o?ne(r):o,oe(ne(n),"toggle",(function(){n.setState({collapsed:!n.state.collapsed})})),oe(ne(n),"onClose",(function(){n.setState({visibleSourceAddForm:!1})})),oe(ne(n),"onOpen",(function(){n.setState({visibleSourceAddForm:!n.state.visibleSourceAddForm,visibleId:1})})),oe(ne(n),"onRoleSelect",(function(e,t){for(var r=0;r<n.props.role.length;r++){var o=n.props.role[r];if(o.id===t){n.setState({selectRoleName:o.name,selectRoleId:o.id}),n.props.modelPermissionItem({id:o.id});break}}document.querySelectorAll(".list-role-item").forEach((function(e){e.setAttribute("style","background: #fff")})),document.querySelector(".list-role-item-".concat(t)).setAttribute("style","background: #fafafa")})),oe(ne(n),"shouldComponentUpdate",(function(e,t){return e.permission!==n.props.permission||t.visibleSourceAddForm!==n.state.visibleSourceAddForm||t.collapsed!==n.state.collapsed||e.role!==n.props.role})),oe(ne(n),"permissionsSwitch",(function(e,t,r){n.props.modelPermissionSwitch({enabled:r,permission_id:t,role_id:n.state.selectRoleId})})),n.state={selectRoleName:"Гость",selectRoleId:0,collapsed:!0,visibleSourceAddForm:!1,visibleId:null,items:e.items,loading:!0,operationId:""},e.modelServer(),n}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this;if(this.props.current){var t=!this.props.current;return o.a.createElement(S.a,null,o.a.createElement(ie,{width:300,trigger:null,collapsible:!0,collapsed:this.state.collapsed},o.a.createElement("div",{className:"logo"},"USER"),o.a.createElement(P.a,{theme:"dark",mode:"inline",defaultSelectedKeys:["2"]},o.a.createElement(P.a.Item,{key:"1"},o.a.createElement(O.a,{to:"/"},o.a.createElement(I.a,{type:"team"}),o.a.createElement("span",null,"Пользователи"))),o.a.createElement(P.a.Item,{key:"2"},o.a.createElement(O.a,{to:"/role"},o.a.createElement(I.a,{type:"cluster"}),o.a.createElement("span",null,"Роли"))),o.a.createElement(P.a.ItemGroup,{key:"roles",title:""},this.props.role?this.props.role.map((function(t){return o.a.createElement(P.a.Item,{onClick:function(n){e.onRoleSelect(n,t.id)},key:"role-".concat(t.id)},o.a.createElement(I.a,{type:"property-safety"}),o.a.createElement("span",null,t.name))})):null))),o.a.createElement(S.a,null,o.a.createElement(E.a,{title:this.state.selectRoleName}),o.a.createElement(le,null,o.a.createElement(k.a,{title:o.a.createElement("span",null,o.a.createElement(I.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:this.toggle}),"Управление ролями"),subTitle:"текущая: ".concat(this.state.selectRoleName),extra:[o.a.createElement(R.a,{key:"add-role",className:"btn-user-add",onClick:function(){return e.onOpen()},type:"primary",size:"small"},"Управление ролями"),o.a.createElement(p.c,{key:"logout-1"})]})),o.a.createElement(ae,{className:"user-list"},o.a.createElement(C.a,{tip:"Загрузка...",size:"large",spinning:t},o.a.createElement(_.a,null,o.a.createElement(A.a,{span:24},o.a.createElement(w.a,{defaultActiveKey:["1"]},this.props.permission.modules?this.props.permission.modules.map((function(t){return o.a.createElement(se,{header:"".concat(t.name,": ").concat(t.desc),key:t.group},o.a.createElement(D.a,{grid:{gutter:16,xs:1,sm:1,md:2,lg:3,xl:4,xxl:4},dataSource:t.permissions,renderItem:function(t,n){return o.a.createElement(D.a.Item,null,o.a.createElement(O.a,{onClick:function(){e.permissionsSwitch(t.group,t.id,t.enabled)}},o.a.createElement(N.a,{content:t.desc,title:t.name},o.a.createElement(j.a,{className:g()("permissions-default",{"permissions-enabled":t.enabled}),size:"small"},o.a.createElement(ce,{avatar:t.enabled?o.a.createElement(I.a,{type:"check"}):o.a.createElement(I.a,{type:"stop"}),title:t.name})))))}}))})):null)),o.a.createElement(Z,{visible:this.state.visibleSourceAddForm,visibleId:this.state.visibleId,title:"Роли",roleList:this.props.role,onRoleSelect:this.onRoleSelect,actionDelete:this.props.modelRoleDelete,actionEdit:this.props.modelRoleEdit,actionAdd:this.props.modelRoleAdd,onClose:this.onClose,wrappedComponentRef:function(t){return e.form=t}}))))))}return null}}])&&ee(n.prototype,r),l&&ee(n,l),t}(o.a.Component);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=Object(l.connectAdvanced)((function(e){var t="system",n={},r=Object(m.a)(b,t,e),o=function(){return r("roleItems")},a=function(e){return r("permissionItem",e)},i=function(e){return r("permissionSwitch",e)},s=function(e){return r("roleAdd",e,(function(e){return e}))},c=function(e){return r("roleEdit",e,(function(e){return e}))},u=function(e){return r("roleDelete",e,(function(e){return e}))},p=function(){r("userCurrent"),o(),a({id:0})};return function(e,t){var r=function(e){return null===e},m=!!r(e.system.userCurrent),d=r(e.system.roleItems)?null:e.system.roleItems,f=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{loading:m,permission:r(e.system.permissionItem)?null:e.system.permissionItem,role:d,access:r(e.system.userCurrent)?null:e.system.userCurrent.access,current:r(e.system.userCurrent)?null:e.system.userCurrent.data,modelServer:p,modelRoleItems:o,modelPermissionItem:a,modelPermissionSwitch:i,modelRoleDelete:u,modelRoleEdit:c,modelRoleAdd:s});return t,Object(l.shallowEqual)(n,f)||(n=f),n}}))(ue);n(274),t.default=function(e){var t=e.location,n=e.params;return o.a.createElement(l.Provider,{store:u},o.a.createElement(de,{location:t,params:n}))}}}]);
//# sourceMappingURL=role.js.map