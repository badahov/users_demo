(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[8],{105:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(20),o=n(1),a=n.n(o),i=n(434),s=n(131),l=n(59);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=i.a.confirm,h=function(e){function t(){var e,n,o,a,i,s,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];return o=this,n=!(a=(e=p(t)).call.apply(e,[this].concat(d)))||"object"!==u(a)&&"function"!=typeof a?f(o):a,i=f(n),l=function(){m({title:"Вы хотите выйти?",okText:"Да",okType:"danger",cancelText:"Нет",onOk:function(){var e=r.a.domain.auth+r.a.server.setPoint+"/auth/log-out",t=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);t.open("POST",e,!0),t.withCredentials=!0,t.send(),t.onload=function(){var e=r.a.domain.api+r.a.server.setPoint+"/auth/log-out",t=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);t.open("POST",e,!0),t.withCredentials=!0,t.send(),t.onload=function(){r.a.page.login()}}},onCancel:function(){console.log("Cancel handle logout")}})},(s="handleLogout")in i?Object.defineProperty(i,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[s]=l,n}var n,i,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o["Component"]),n=t,(i=[{key:"render",value:function(){return a.a.createElement(s.a,{type:"danger",size:"small",onClick:this.handleLogout},a.a.createElement(l.a,{type:"logout"})," Выход")}}])&&c(n.prototype,i),h&&c(n,h),t}()},175:function(e,t,n){"use strict";t.a={api:{permission:"interface-users/permission",rolePermission:"interface-users/role-permission",roles:"interface-users/roles",roleAdd:"interface-users/role-add",roleEdit:"interface-users/role-edit",roleDelete:"interface-users/role-delete",userCurrent:"interface-users/user-current",userEdit:"interface-users/user-edit"}}},410:function(e,t,n){"use strict";(function(e){var r=n(1),o=n.n(r),a=n(117),i=n.n(a),s=n(52),l=n.n(s),u=n(6),c=n(68),p=n(65),f=n(422),d=n(421),m=n(424),h=n(432),y=n(428),b=n(420),v=n(59),E=n(431),g=n(405),w=n(316),_=n(321),O=n(438),S=n(426),R=n(105),P=n(415);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=m.a.Header,L=m.a.Content,N=m.a.Sider,x=h.a.Panel,U=y.a.Meta,M=function(t){function n(t){var r,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o=this,a=j(n).call(this,t),r=!a||"object"!==k(a)&&"function"!=typeof a?I(o):a,C(I(r),"toggle",function(){r.setState({collapsed:!r.state.collapsed})}),C(I(r),"onClose",function(){r.setState({visibleSourceAddForm:!1})}),C(I(r),"onOpen",function(){r.setState({visibleSourceAddForm:!r.state.visibleSourceAddForm,visibleId:1})}),C(I(r),"onRoleSelect",function(t){for(var n=0;n<r.props.role.length;n++){var o=r.props.role[n];if(o.id===t){r.setState({selectRoleName:o.name,selectRoleId:o.id}),r.props.actionPermission("item",{id:o.id});break}}e(".list-role-item").css({background:"#fff"}),e(".list-role-item-"+t).css({background:"#fafafa"})}),C(I(r),"shouldComponentUpdate",function(e,t){return e.permission!==r.props.permission||t.visibleSourceAddForm!==r.state.visibleSourceAddForm||t.collapsed!==r.state.collapsed||e.role!==r.props.role}),C(I(r),"permissionsSwitch",function(e,t,n){r.props.actionPermission("switch",{enabled:n,permission_id:t,role_id:r.state.selectRoleId})}),r.state={selectRoleName:"Гость",selectRoleId:0,collapsed:!0,visibleSourceAddForm:!1,visibleId:null,items:t.items,loading:!0,operationId:""},r.props.actionCurrent(),r.props.actionRole("items"),r.props.actionPermission("item",{id:0}),r}var r,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(n,o.a.Component),r=n,(a=[{key:"render",value:function(){var e=this;if(this.props.current){var t=!this.props.current;return o.a.createElement(m.a,null,o.a.createElement(N,{width:300,trigger:null,collapsible:!0,collapsed:this.state.collapsed},o.a.createElement("div",{className:"logo"},"USER"),o.a.createElement(b.b,{theme:"dark",mode:"inline",defaultSelectedKeys:["2"]},o.a.createElement(b.b.Item,{key:"1"},o.a.createElement(u.a,{to:"/"},o.a.createElement(v.a,{type:"team"}),o.a.createElement("span",null,"Пользователи"))),o.a.createElement(b.b.Item,{key:"2"},o.a.createElement(u.a,{to:"/role"},o.a.createElement(v.a,{type:"cluster"}),o.a.createElement("span",null,"Роли"))),o.a.createElement(b.b.ItemGroup,{key:"roles",title:""},this.props.role?this.props.role.map(function(t){return o.a.createElement(b.b.Item,{onClick:function(){e.onRoleSelect(t.id)},key:"role-".concat(t.id)},o.a.createElement(v.a,{type:"property-safety"}),o.a.createElement("span",null,t.name))}):null))),o.a.createElement(m.a,null,o.a.createElement(i.a,{title:this.state.selectRoleName}),o.a.createElement(D,null,o.a.createElement(E.a,{title:o.a.createElement("span",null,o.a.createElement(v.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:this.toggle}),"Управление ролями"),subTitle:"текущая: ".concat(this.state.selectRoleName),extra:[o.a.createElement(u.a,{key:"add-user"},o.a.createElement(v.a,{type:"plus",onClick:function(){return e.onOpen()}})),o.a.createElement(R.a,{key:"logout-1"})]})),o.a.createElement(L,{className:"user-list"},o.a.createElement(g.a,{tip:"Загрузка...",size:"large",spinning:t},o.a.createElement(w.a,null,o.a.createElement(_.a,{span:24},o.a.createElement(h.a,{defaultActiveKey:["1"]},this.props.permission.modules?this.props.permission.modules.map(function(t){return o.a.createElement(x,{header:"".concat(t.name,": ").concat(t.desc),key:t.group},o.a.createElement(O.a,{grid:{gutter:16,xs:1,sm:1,md:2,lg:3,xl:4,xxl:4},dataSource:t.permissions,renderItem:function(t,n){return o.a.createElement(O.a.Item,null,o.a.createElement(u.a,{onClick:function(){e.permissionsSwitch(t.group,t.id,t.enabled)}},o.a.createElement(S.a,{content:t.desc,title:t.name},o.a.createElement(y.a,{className:l()("permissions-default",{"permissions-enabled":t.enabled}),size:"small"},o.a.createElement(U,{avatar:t.enabled?o.a.createElement(v.a,{type:"check"}):o.a.createElement(v.a,{type:"stop"}),title:t.name})))))}}))}):null)),o.a.createElement(P.a,{visible:this.state.visibleSourceAddForm,visibleId:this.state.visibleId,title:"Роли",onRoleSelect:this.onRoleSelect,roleList:this.props.role,actionRole:this.props.actionRole,onClose:this.onClose,wrappedComponentRef:function(t){return e.form=t}}))))))}return null}}])&&T(r.prototype,a),s&&T(r,s),n}();t.a=Object(c.connect)(function(e){return{access:e.user.access,action:e.user.action,current:e.user.current,role:e.role.role,permission:e.role.permission}},function(e){return Object(p.bindActionCreators)({actionCurrent:f.a,actionEdit:f.b,actionPermission:d.a,actionRole:d.b,dispatch:e},e)})(M)}).call(this,n(29))},415:function(e,t,n){"use strict";(function(e){var r=n(1),o=n.n(r),a=n(6),i=n(131),s=n(433),l=n(437),u=n(436),c=n(316),p=n(321),f=n(427),d=n(438),m=n(425),h=n(59);function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_(e,t,n[t])})}return e}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=i.a.Group,S=s.a.Search,R=function(t){function n(t){var r,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o=this,a=E(n).call(this,t),r=!a||"object"!==b(a)&&"function"!=typeof a?g(o):a,_(g(r),"handleSubmit",function(e){e.preventDefault(),r.props.form.validateFieldsAndScroll(function(e,t){e||(delete t.confirm,r.props.actionRole("add",t))})}),_(g(r),"onClose",function(){r.props.onClose()}),_(g(r),"onRoleEditAction",function(t){e(".link-role-name-"+t).hide(),e(".input-role-name-"+t).show(),e(".btn-role-edit-"+t).hide(),e(".btn-role-delete-"+t).hide(),e(".btn-role-save-"+t).show()}),_(g(r),"onRoleDelete",function(e){r.props.actionRole("delete",{id:e},function(e){return"ok"===e.status?(e.msg&&(l.a.success(e.msg),r.props.onRoleSelect(0)),!e.result||e.result):e.msg?(l.a.error(r._errorMsg(e.msg)),!1):void 0})}),_(g(r),"onRoleEdit",function(t,n){r.props.actionRole("edit",{id:t,name:n},function(n){return"ok"===n.status?(n.msg&&l.a.success(n.msg),!n.result||(e(".link-role-name-"+t).show(),e(".input-role-name-"+t).hide(),e(".btn-role-edit-"+t).show(),e(".btn-role-delete-"+t).show(),e(".btn-role-save-"+t).hide(),n.result)):n.msg?(l.a.error(r._errorMsg(n.msg)),!1):void 0})}),_(g(r),"shouldComponentUpdate",function(e,t){return r.props.visible!==e.visible&&r.setState({visible:e.visible}),!0}),r.state={visible:t.visible},r}var y,R,P;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(n,r["Component"]),y=n,(R=[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator;return o.a.createElement(u.a,{title:this.props.title,width:550,onClose:this.onClose,visible:this.state.visible,zIndex:1050},o.a.createElement(c.a,{style:{marginBottom:"20px"}},o.a.createElement(p.a,{span:24},o.a.createElement(f.a,{layout:"inline",onSubmit:this.handleSubmit},o.a.createElement(f.a.Item,{hasFeedback:!0},t("name",{})(o.a.createElement(s.a,{placeholder:"Название новой роли"}))),o.a.createElement(f.a.Item,null,o.a.createElement(i.a,{type:"primary",htmlType:"submit"},"Добавить")))),o.a.createElement(p.a,{span:24},o.a.createElement(d.a,{size:"small",style:{marginTop:"10px"},bordered:!0,dataSource:this.props.roleList,renderItem:function(t){return o.a.createElement(d.a.Item,{className:"list-role-item list-role-item-".concat(t.id),actions:t.editable?[o.a.createElement(O,null,o.a.createElement(i.a,{className:"btn-role-edit btn-role-edit-".concat(t.id),onClick:function(){return e.onRoleEditAction(t.id)},size:"small",icon:"edit"}),o.a.createElement(m.a,{title:"Удалить роль?",onConfirm:function(){return e.onRoleDelete(t.id)},okText:"Да",cancelText:"Нет",placement:"left",zIndex:1050},o.a.createElement(i.a,{className:"btn-role-delete btn-role-delete-".concat(t.id),size:"small",icon:"delete"})))]:null},o.a.createElement(a.a,{onClick:function(){return e.props.onRoleSelect(t.id)},className:"link-role-name link-role-name-".concat(t.id),style:{width:"100%"}},t.name),o.a.createElement(S,{className:"input-role-name input-role-name-".concat(t.id),placeholder:"Название новой роли",enterButton:o.a.createElement(h.a,{type:"save"}),size:"small",defaultValue:t.name,onSearch:function(n){return e.onRoleEdit(t.id,n)}}))}}))))}}])&&v(y.prototype,R),P&&v(y,P),n}();_(R,"defaultProps",{visible:!0,visibleId:null,successionId:null,operationId:null,inputSourceId:null,stageId:null,title:null}),t.a=f.a.create({name:"user_add_form",mapPropsToFields:function(e){return{title:f.a.createFormField(y({},e.sourceTitle,{value:e.sourceTitle}))}}})(R)}).call(this,n(29))},416:function(e,t,n){},421:function(e,t,n){"use strict";var r=n(85),o=n(175).a.api;function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.a.post;return new r.a({pointApi:e,type:n,data:t})}function i(e,t,n){switch(e){case"item":return a(o.permission,t,r.a.get).result();case"switch":return a(o.rolePermission,t,r.a.post).result().then(function(e){if(e)return a(o.permission,{id:t.role_id},r.a.get).result()})}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;switch(e){case"items":return a(o.roles,t,r.a.get).result();case"add":return a(o.roleAdd,t,r.a.post).result().then(function(e){if(e)return a(o.roles).result()});case"edit":return a(o.roleEdit,t,r.a.post).result().then(function(e){if(e)return a(o.roles).result(n)});case"delete":return a(o.roleDelete,t,r.a.post).result(n).then(function(e){if(e)return a(o.roles).result()})}}function l(e,t,n){return{type:"PERMISSION",actions:["PERMISSION_LOADING","PERMISSION_LOADED","PERMISSION_LOAD_FAILURE"],promise:i(e,t)}}function u(e,t,n){return{type:"ROLE",actions:["ROLE_LOADING","ROLE_LOADED","ROLE_LOAD_FAILURE"],promise:s(e,t,n)}}n.d(t,"a",function(){return l}),n.d(t,"b",function(){return u})},422:function(e,t,n){"use strict";var r=n(85),o=n(175),a=o.a.api;function i(e,t,n){return new r.a({pointApi:a.userEdit,data:e}).result().then(function(e){e&&n instanceof Function&&n(t)})}function s(){return{type:"USER_CURRENT",actions:["USER_CURRENT_LOADING","USER_CURRENT_LOADED","USER_CURRENT_LOAD_FAILURE"],promise:new r.a({domain:o.a.domain.auth,type:r.a.get,pointApi:a.userCurrent}).result()}}function l(e){return{type:"USER_EDIT",actions:["USER_EDIT_LOADED"],model:i(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return l})},435:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"user",function(){return d}),n.d(r,"role",function(){return m});var o=n(1),a=n.n(o),i=n(68),s=n(65),l=n(107);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=function(e){return function(t){return function(n){switch(n.type){case"USER_CURRENT":case"USER_ITEM":var r=u(n.actions,3),o=r[0],a=r[1],i=r[2];e.dispatch({type:o,data:"start"}),n.promise.then(function(t){e.dispatch({type:a,data:t}),e.dispatch({type:o,data:"end"})},function(t){e.dispatch({type:i,error:t})});break;default:return t(n)}}}};function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=function(e){return function(t){return function(n){switch(n.type){case"PERMISSION":case"ROLE":var r=p(n.actions,3),o=r[0],a=r[1],i=r[2];e.dispatch({type:o}),n.promise.then(function(t){e.dispatch({type:a,data:t})},function(t){e.dispatch({type:i,error:t})});break;default:return t(n)}}}},d=Object(s.combineReducers)({action:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"USER_ITEM_LOADING":return t.data;default:return e}},current:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"USER_CURRENT_LOADED":return t.data;default:return e}},item:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"USER_ITEM_LOADED":return t.data;default:return e}}}),m=Object(s.combineReducers)({role:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ROLE_LOADED":return t.data;default:return e}},permission:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PERMISSION_LOADED":return t.data;default:return e}}}),h=Object(s.applyMiddleware)(c,f,l.a)(s.createStore)(Object(s.combineReducers)(r)),y=n(410);n(416);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,g(t).apply(this,arguments))}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,o["Component"]),n=t,(r=[{key:"render",value:function(){return a.a.createElement(i.Provider,{store:h},a.a.createElement(y.a,{header:this.props.header,location:this.props.location,params:this.props.params}))}}])&&v(n.prototype,r),s&&v(n,s),t}();t.default=_},85:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(20);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=n(169),s=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"type","POST"),a(this,"data",null),a(this,"pointApi",null),a(this,"domain",r.a.domain.api),a(this,"send",function(){return n._fetch()}),a(this,"result",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n.send().then(function(t){return e instanceof Function?e(t):"ok"===t.status?(t.msg&&n._success(t.msg),!t.result||t.result):t.msg?(n._error(n._errorMsg(t.msg)),!1):void 0})}),a(this,"_getUrl",function(){var t="";if(n.type===e.get){var o=null;n.data&&(o=n._getParams(n.data)),t=o?n.domain+r.a.server.setPoint+n.pointApi+r.a.server.prefix+o:n.domain+r.a.server.setPoint+n.pointApi}else t=n.domain+r.a.server.setPoint+n.pointApi;return t}),a(this,"_getFetchParam",function(){return n.type===e.get?{method:e.get,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}:{method:e.post,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n.data),credentials:"include"}}),a(this,"_fetch",function(){var e=n._getUrl(),t=n._getFetchParam();return i(e,t).then(function(t){if(200===t.status)return t.json();if(500===t.status)throw n._error(r.a.error[t.status]),t.statusText;if(404===t.status)throw n._error(r.a.error[t.status]),t.statusText;if(417===t.status)throw t.json().then(function(e){e.status?n._error(r.a.error[t.status]):n._error(n._errorMsg(e.msg))}),t.statusText;if(423===t.status)throw n._error(r.a.error[t.status]),t.statusText;if(401!==t.status)throw 403===t.status?(n._error(r.a.error[t.status]),t.statusText):t.statusText;n._requestXdomainToken(e)})}),a(this,"_error",function(e){r.a.message.error(e)}),a(this,"_success",function(e){r.a.message.success(e)}),a(this,"_errorMsg",function(e){if("string"==typeof e)return e;var t=['<ul class="list-unstyled">'];return e.map(function(e){return t.push("<li>"+e+"</li>")}),t.push("</ul>"),t.join(" ")}),a(this,"_getParams",function(e){return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")}),void 0!==t.type&&(this.type=t.type),void 0!==t.data&&(this.data=t.data),void 0!==t.pointApi&&(this.pointApi=t.pointApi),void 0!==t.domain&&(this.domain=t.domain)}var t,n,s;return t=e,(n=[{key:"_requestXdomainToken",value:function(e){var t=r.a.domain.auth+r.a.server.setPoint+"/auth/get-xdomain-token",n=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);n.open("POST",t,!0),n.withCredentials=!0,n.send();var o=this;n.onload=function(){switch(console.log("requestXdomainToken"),this.status){case 401:o._loginPage();break;case 200:var t=JSON.parse(this.responseText),n=e.split("/"),a=n[0]+"//"+n[2]+r.a.server.setPoint+"auth/login",i=new FormData;i.append("xdomainToken",t.xdomainToken);var s=new XMLHttpRequest;s.open("POST",a,!0),s.withCredentials=!0,s.send(i),s.onload=function(){switch(this.status){case 401:o._loginPage();break;case 200:location.reload()}}}}}},{key:"_loginPage",value:function(){r.a.history.push("/login")}}])&&o(t.prototype,n),s&&o(t,s),e}();a(s,"post","POST"),a(s,"get","GET")}}]);
//# sourceMappingURL=8.js.map